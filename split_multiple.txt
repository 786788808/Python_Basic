import os
import pandas as pd
from Webs_US_Sanction import parse_file

class TestConfig:
    def __init__(self, xml_path, csv_path, file_date='20250704', order_date='20250704', gcp_env='dev'):
        self.file_path = xml_path
        self.csv_path = csv_path
        self.file_date = file_date
        self.order_date = order_date
        self.gcp_env = gcp_env

def test_parse_file_with_sample():
    # 获取当前测试文件目录
    current_dir = os.path.dirname(os.path.abspath(__file__))
    # 拼接 xml 路径（和你文件夹结构一致）
    xml_path = os.path.join(current_dir, 'mock_data', 'Webs_US_Sanction.xml')
    # 生成一个临时 csv 路径
    csv_path = os.path.join(current_dir, 'mock_data', 'Webs_US_Sanction_test_output.csv')

    config = TestConfig(xml_path, csv_path)
    parse_file(config)

    # 检查 csv 是否生成
    assert os.path.exists(csv_path)
    # 检查内容
    df = pd.read_csv(csv_path)
    assert 'EntityName' in df.columns
    assert 'SanctionProgram' in df.columns
    # 你可以加更多断言，比如行数、某些值等

    # 清理生成的测试文件
    os.remove(csv_path)
